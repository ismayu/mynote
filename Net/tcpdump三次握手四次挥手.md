使用`nc -v -l 127.0.0.1 12345`模拟服务器

使用`nc -v 127.0.0.1 12345`模拟客户端（此处客户端发送了一个包）

使用`tcpdump -i any 'port 12345' -XX -nn -vv`抓取端口为12345的网络包

```
[root@izuf65o0c0mq1fel15ftitz ~]# tcpdump -i any 'port 12345' -XX -nn -vv
tcpdump: listening on any, link-type LINUX_SLL (Linux cooked), capture size 262144 bytes
15:26:40.331606 IP (tos 0x0, ttl 64, id 29534, offset 0, flags [DF], proto TCP (6), length 60)
    127.0.0.1.57308 > 127.0.0.1.12345: Flags [S], cksum 0xfe30 (incorrect -> 0xa10d), seq 1324410503, win 43690, options [mss 65495,sackOK,TS val 683316697 ecr 0,nop,wscale 7], length 0
        0x0000:  0000 0304 0006 0000 0000 0000 0000 0800  ................
        0x0010:  4500 003c 735e 4000 4006 c95b 7f00 0001  E..<s^@.@..[....
        0x0020:  7f00 0001 dfdc 3039 4ef0 e687 0000 0000  ......09N.......
        0x0030:  a002 aaaa fe30 0000 0204 ffd7 0402 080a  .....0..........
        0x0040:  28ba 95d9 0000 0000 0103 0307 0000 0000  (...............
        0x0050:  0000 0000 0000 0000 0000 0000            ............
15:26:40.331616 IP (tos 0x0, ttl 64, id 0, offset 0, flags [DF], proto TCP (6), length 60)
    127.0.0.1.12345 > 127.0.0.1.57308: Flags [S.], cksum 0xfe30 (incorrect -> 0xf872), seq 1929148153, ack 1324410504, win 43690, options [mss 65495,sackOK,TS val 683316697 ecr 683316697,nop,wscale 7], length 0
        0x0000:  0000 0304 0006 0000 0000 0000 0000 0800  ................
        0x0010:  4500 003c 0000 4000 4006 3cba 7f00 0001  E..<..@.@.<.....
        0x0020:  7f00 0001 3039 dfdc 72fc 76f9 4ef0 e688  ....09..r.v.N...
        0x0030:  a012 aaaa fe30 0000 0204 ffd7 0402 080a  .....0..........
        0x0040:  28ba 95d9 28ba 95d9 0103 0307 0000 0000  (...(...........
        0x0050:  0000 0000 0000 0000 0000 0000            ............
15:26:40.331624 IP (tos 0x0, ttl 64, id 29535, offset 0, flags [DF], proto TCP (6), length 52)
    127.0.0.1.57308 > 127.0.0.1.12345: Flags [.], cksum 0xfe28 (incorrect -> 0xcab7), seq 1, ack 1, win 342, options [nop,nop,TS val 683316697 ecr 683316697], length 0
        0x0000:  0000 0304 0006 0000 0000 0000 0000 0800  ................
        0x0010:  4500 0034 735f 4000 4006 c962 7f00 0001  E..4s_@.@..b....
        0x0020:  7f00 0001 dfdc 3039 4ef0 e688 72fc 76fa  ......09N...r.v.
        0x0030:  8010 0156 fe28 0000 0101 080a 28ba 95d9  ...V.(......(...
        0x0040:  28ba 95d9 0000 0000 0000 0000 0000 0000  (...............
        0x0050:  0000 0000                                ....
15:26:58.147878 IP (tos 0x0, ttl 64, id 29536, offset 0, flags [DF], proto TCP (6), length 54)
    127.0.0.1.57308 > 127.0.0.1.12345: Flags [P.], cksum 0xfe2a (incorrect -> 0x140b), seq 1:3, ack 1, win 342, options [nop,nop,TS val 683334513 ecr 683316697], length 2
        0x0000:  0000 0304 0006 0000 0000 0000 0000 0800  ................
        0x0010:  4500 0036 7360 4000 4006 c95f 7f00 0001  E..6s`@.@.._....
        0x0020:  7f00 0001 dfdc 3039 4ef0 e688 72fc 76fa  ......09N...r.v.
        0x0030:  8018 0156 fe2a 0000 0101 080a 28ba db71  ...V.*......(..q
        0x0040:  28ba 95d9 710a 0000 0000 0000 0000 0000  (...q...........
        0x0050:  0000 0000 0000                           ......
15:26:58.147889 IP (tos 0x0, ttl 64, id 58147, offset 0, flags [DF], proto TCP (6), length 52)
    127.0.0.1.12345 > 127.0.0.1.57308: Flags [.], cksum 0xfe28 (incorrect -> 0x3f85), seq 1, ack 3, win 342, options [nop,nop,TS val 683334513 ecr 683334513], length 0
        0x0000:  0000 0304 0006 0000 0000 0000 0000 0800  ................
        0x0010:  4500 0034 e323 4000 4006 599e 7f00 0001  E..4.#@.@.Y.....
        0x0020:  7f00 0001 3039 dfdc 72fc 76fa 4ef0 e68a  ....09..r.v.N...
        0x0030:  8010 0156 fe28 0000 0101 080a 28ba db71  ...V.(......(..q
        0x0040:  28ba db71 0000 0000 0000 0000 0000 0000  (..q............
        0x0050:  0000 0000                                ....
15:27:20.029315 IP (tos 0x0, ttl 64, id 29537, offset 0, flags [DF], proto TCP (6), length 52)
    127.0.0.1.57308 > 127.0.0.1.12345: Flags [F.], cksum 0xfe28 (incorrect -> 0xea09), seq 3, ack 1, win 342, options [nop,nop,TS val 683356395 ecr 683334513], length 0
        0x0000:  0000 0304 0006 0000 0000 0000 0000 0800  ................
        0x0010:  4500 0034 7361 4000 4006 c960 7f00 0001  E..4sa@.@..`....
        0x0020:  7f00 0001 dfdc 3039 4ef0 e68a 72fc 76fa  ......09N...r.v.
        0x0030:  8011 0156 fe28 0000 0101 080a 28bb 30eb  ...V.(......(.0.
        0x0040:  28ba db71 0000 0000 0000 0000 0000 0000  (..q............
        0x0050:  0000 0000                                ....
15:27:20.029494 IP (tos 0x0, ttl 64, id 58148, offset 0, flags [DF], proto TCP (6), length 52)
    127.0.0.1.12345 > 127.0.0.1.57308: Flags [F.], cksum 0xfe28 (incorrect -> 0x948e), seq 1, ack 4, win 342, options [nop,nop,TS val 683356395 ecr 683356395], length 0
        0x0000:  0000 0304 0006 0000 0000 0000 0000 0800  ................
        0x0010:  4500 0034 e324 4000 4006 599d 7f00 0001  E..4.$@.@.Y.....
        0x0020:  7f00 0001 3039 dfdc 72fc 76fa 4ef0 e68b  ....09..r.v.N...
        0x0030:  8011 0156 fe28 0000 0101 080a 28bb 30eb  ...V.(......(.0.
        0x0040:  28bb 30eb 0000 0000 0000 0000 0000 0000  (.0.............
        0x0050:  0000 0000                                ....
15:27:20.029505 IP (tos 0x0, ttl 64, id 29538, offset 0, flags [DF], proto TCP (6), length 52)
    127.0.0.1.57308 > 127.0.0.1.12345: Flags [.], cksum 0xfe28 (incorrect -> 0x948e), seq 4, ack 2, win 342, options [nop,nop,TS val 683356395 ecr 683356395], length 0
        0x0000:  0000 0304 0006 0000 0000 0000 0000 0800  ................
        0x0010:  4500 0034 7362 4000 4006 c95f 7f00 0001  E..4sb@.@.._....
        0x0020:  7f00 0001 dfdc 3039 4ef0 e68b 72fc 76fb  ......09N...r.v.
        0x0030:  8010 0156 fe28 0000 0101 080a 28bb 30eb  ...V.(......(.0.
        0x0040:  28bb 30eb 0000 0000 0103 0307 0000 0000  (.0.............
        0x0050:  0000 0000                                ....
```

三次握手：

```
15:26:40.331606 IP (tos 0x0, ttl 64, id 29534, offset 0, flags [DF], proto TCP (6), length 60)
    127.0.0.1.57308 > 127.0.0.1.12345: Flags [S], cksum 0xfe30 (incorrect -> 0xa10d), seq 1324410503, win 43690, options [mss 65495,sackOK,TS val 683316697 ecr 0,nop,wscale 7], length 0
        0x0000:  0000 0304 0006 0000 0000 0000 0000 0800  ................
        0x0010:  4500 003c 735e 4000 4006 c95b 7f00 0001  E..<s^@.@..[....
        0x0020:  7f00 0001 dfdc 3039 4ef0 e687 0000 0000  ......09N.......
        0x0030:  a002 aaaa fe30 0000 0204 ffd7 0402 080a  .....0..........
        0x0040:  28ba 95d9 0000 0000 0103 0307 0000 0000  (...............
        0x0050:  0000 0000 0000 0000 0000 0000            ............
15:26:40.331616 IP (tos 0x0, ttl 64, id 0, offset 0, flags [DF], proto TCP (6), length 60)
    127.0.0.1.12345 > 127.0.0.1.57308: Flags [S.], cksum 0xfe30 (incorrect -> 0xf872), seq 1929148153, ack 1324410504, win 43690, options [mss 65495,sackOK,TS val 683316697 ecr 683316697,nop,wscale 7], length 0
        0x0000:  0000 0304 0006 0000 0000 0000 0000 0800  ................
        0x0010:  4500 003c 0000 4000 4006 3cba 7f00 0001  E..<..@.@.<.....
        0x0020:  7f00 0001 3039 dfdc 72fc 76f9 4ef0 e688  ....09..r.v.N...
        0x0030:  a012 aaaa fe30 0000 0204 ffd7 0402 080a  .....0..........
        0x0040:  28ba 95d9 28ba 95d9 0103 0307 0000 0000  (...(...........
        0x0050:  0000 0000 0000 0000 0000 0000            ............
15:26:40.331624 IP (tos 0x0, ttl 64, id 29535, offset 0, flags [DF], proto TCP (6), length 52)
    127.0.0.1.57308 > 127.0.0.1.12345: Flags [.], cksum 0xfe28 (incorrect -> 0xcab7), seq 1, ack 1, win 342, options [nop,nop,TS val 683316697 ecr 683316697], length 0
        0x0000:  0000 0304 0006 0000 0000 0000 0000 0800  ................
        0x0010:  4500 0034 735f 4000 4006 c962 7f00 0001  E..4s_@.@..b....
        0x0020:  7f00 0001 dfdc 3039 4ef0 e688 72fc 76fa  ......09N...r.v.
        0x0030:  8010 0156 fe28 0000 0101 080a 28ba 95d9  ...V.(......(...
        0x0040:  28ba 95d9 0000 0000 0000 0000 0000 0000  (...............
        0x0050:  0000 0000                                ....
```

Flags[S]  为连接端发送连接的SYN

Flags[S.] 为接受端接受到SYN之后回应给连接端SYN+ACK

Flags[.] 为连接端接手到SYN+ACK，并回应ACK

发送消息：

```
15:26:58.147878 IP (tos 0x0, ttl 64, id 29536, offset 0, flags [DF], proto TCP (6), length 54)
    127.0.0.1.57308 > 127.0.0.1.12345: Flags [P.], cksum 0xfe2a (incorrect -> 0x140b), seq 1:3, ack 1, win 342, options [nop,nop,TS val 683334513 ecr 683316697], length 2
        0x0000:  0000 0304 0006 0000 0000 0000 0000 0800  ................
        0x0010:  4500 0036 7360 4000 4006 c95f 7f00 0001  E..6s`@.@.._....
        0x0020:  7f00 0001 dfdc 3039 4ef0 e688 72fc 76fa  ......09N...r.v.
        0x0030:  8018 0156 fe2a 0000 0101 080a 28ba db71  ...V.*......(..q
        0x0040:  28ba 95d9 710a 0000 0000 0000 0000 0000  (...q...........
        0x0050:  0000 0000 0000                           ......
15:26:58.147889 IP (tos 0x0, ttl 64, id 58147, offset 0, flags [DF], proto TCP (6), length 52)
    127.0.0.1.12345 > 127.0.0.1.57308: Flags [.], cksum 0xfe28 (incorrect -> 0x3f85), seq 1, ack 3, win 342, options [nop,nop,TS val 683334513 ecr 683334513], length 0
        0x0000:  0000 0304 0006 0000 0000 0000 0000 0800  ................
        0x0010:  4500 0034 e323 4000 4006 599e 7f00 0001  E..4.#@.@.Y.....
        0x0020:  7f00 0001 3039 dfdc 72fc 76fa 4ef0 e68a  ....09..r.v.N...
        0x0030:  8010 0156 fe28 0000 0101 080a 28ba db71  ...V.(......(..q
        0x0040:  28ba db71 0000 0000 0000 0000 0000 0000  (..q............
        0x0050:  0000 0000                                ....
```

四次挥手：

```
15:27:20.029315 IP (tos 0x0, ttl 64, id 29537, offset 0, flags [DF], proto TCP (6), length 52)
    127.0.0.1.57308 > 127.0.0.1.12345: Flags [F.], cksum 0xfe28 (incorrect -> 0xea09), seq 3, ack 1, win 342, options [nop,nop,TS val 683356395 ecr 683334513], length 0
        0x0000:  0000 0304 0006 0000 0000 0000 0000 0800  ................
        0x0010:  4500 0034 7361 4000 4006 c960 7f00 0001  E..4sa@.@..`....
        0x0020:  7f00 0001 dfdc 3039 4ef0 e68a 72fc 76fa  ......09N...r.v.
        0x0030:  8011 0156 fe28 0000 0101 080a 28bb 30eb  ...V.(......(.0.
        0x0040:  28ba db71 0000 0000 0000 0000 0000 0000  (..q............
        0x0050:  0000 0000                                ....
15:27:20.029494 IP (tos 0x0, ttl 64, id 58148, offset 0, flags [DF], proto TCP (6), length 52)
    127.0.0.1.12345 > 127.0.0.1.57308: Flags [F.], cksum 0xfe28 (incorrect -> 0x948e), seq 1, ack 4, win 342, options [nop,nop,TS val 683356395 ecr 683356395], length 0
        0x0000:  0000 0304 0006 0000 0000 0000 0000 0800  ................
        0x0010:  4500 0034 e324 4000 4006 599d 7f00 0001  E..4.$@.@.Y.....
        0x0020:  7f00 0001 3039 dfdc 72fc 76fa 4ef0 e68b  ....09..r.v.N...
        0x0030:  8011 0156 fe28 0000 0101 080a 28bb 30eb  ...V.(......(.0.
        0x0040:  28bb 30eb 0000 0000 0000 0000 0000 0000  (.0.............
        0x0050:  0000 0000                                ....
15:27:20.029505 IP (tos 0x0, ttl 64, id 29538, offset 0, flags [DF], proto TCP (6), length 52)
    127.0.0.1.57308 > 127.0.0.1.12345: Flags [.], cksum 0xfe28 (incorrect -> 0x948e), seq 4, ack 2, win 342, options [nop,nop,TS val 683356395 ecr 683356395], length 0
        0x0000:  0000 0304 0006 0000 0000 0000 0000 0800  ................
        0x0010:  4500 0034 7362 4000 4006 c95f 7f00 0001  E..4sb@.@.._....
        0x0020:  7f00 0001 dfdc 3039 4ef0 e68b 72fc 76fb  ......09N...r.v.
        0x0030:  8010 0156 fe28 0000 0101 080a 28bb 30eb  ...V.(......(.0.
        0x0040:  28bb 30eb 0000 0000 0103 0307 0000 0000  (.0.............
        0x0050:  0000 0000                                ....
```

这里需要注意TCP的连接机制，在一端发送FIN包之后，接收端如果此时需要发送数据，那么数据会和ACK一起发送，如果没有数据则ACK单独发送。在抓包过程中，客户端发送FIN之后，服务端在ACK发送时间内也发送FIN包，于是就只有三个数据包了。

> 因为在TCP连接过程中，确认的发送有一个延时（即经受延时的确认），一端在发送确认的时候将等待一段时间，如果自己在这段事件内也有数据要发送，就跟确认一起发送，如果没有，则确认单独发送。而我们的抓包实验中，由服务器端先断开连接，之后客户端在确认的延迟时间内，也有请求断开连接需要发送，于是就与上次确认一起发送，因此就只有三个数据报了。